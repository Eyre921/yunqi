# æ•…éšœæ’é™¤

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**   
- [nextjs15-build-error.md](file://log/nextjs15-build-error.md)
- [online-counter-issue.md](file://log/online-counter-issue.md)
- [random-likes-feature.md](file://log/random-likes-feature.md)
- [verify-database.ts](file://verify-database.ts)
- [signin/page.tsx](file://src/app/auth/signin/page.tsx)
- [upload/page.tsx](file://src/app/upload/page.tsx)
- [OnlineCounter.tsx](file://src/components/OnlineCounter.tsx)
- [route.ts](file://src/app/api/online-counter/route.ts)
- [route.ts](file://src/app/api/admin/works/[id]/route.ts)
</cite>

## ç›®å½•
1. [å¼•è¨€](#å¼•è¨€)
2. [ç³»ç»Ÿæ€§è¯Šæ–­æµç¨‹](#ç³»ç»Ÿæ€§è¯Šæ–­æµç¨‹)
3. [å¸¸è§æ•…éšœä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§æ•…éšœä¸è§£å†³æ–¹æ¡ˆ)
4. [æ•°æ®åº“éªŒè¯è„šæœ¬ä½¿ç”¨è¯´æ˜](#æ•°æ®åº“éªŒè¯è„šæœ¬ä½¿ç”¨è¯´æ˜)
5. [é™„å½•](#é™„å½•)

## å¼•è¨€
æœ¬æ–‡æ¡£æ—¨åœ¨ä¸ºå¼€å‘å’Œè¿ç»´äººå‘˜æä¾›ä¸€ä»½åº”æ€¥æ‰‹å†Œï¼ŒåŸºäºé¡¹ç›®æ—¥å¿—ä¸­çš„å®é™…é—®é¢˜è®°å½•ï¼Œæ±‡æ€»å¸¸è§æ•…éšœåŠå…¶è§£å†³æ–¹æ¡ˆã€‚å†…å®¹æ¶µç›–Next.js 15æ„å»ºé”™è¯¯ã€åœ¨çº¿äººæ•°ç»Ÿè®¡ç»„ä»¶é—®é¢˜ã€éšæœºç‚¹èµåŠŸèƒ½å¼‚å¸¸ç­‰å…¸å‹åœºæ™¯ï¼Œå¹¶æä¾›æ•°æ®åº“éªŒè¯è„šæœ¬çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¸®åŠ©å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚

## ç³»ç»Ÿæ€§è¯Šæ–­æµç¨‹
å½“ç³»ç»Ÿå‡ºç°å¼‚å¸¸æ—¶ï¼Œå»ºè®®æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œç³»ç»Ÿæ€§æ’æŸ¥ï¼š

1. **æ£€æŸ¥æ—¥å¿—æ–‡ä»¶**ï¼šé¦–å…ˆæŸ¥çœ‹`log/`ç›®å½•ä¸‹çš„ç›¸å…³æ—¥å¿—æ–‡ä»¶ï¼Œç¡®è®¤é—®é¢˜ç±»å‹å’Œå‘ç”Ÿæ—¶é—´ã€‚
2. **éªŒè¯æ•°æ®åº“çŠ¶æ€**ï¼šè¿è¡Œ`verify-database.ts`è„šæœ¬ï¼Œæ£€æŸ¥æ•°æ®åº“è¿æ¥å’Œæ•°æ®ä¸€è‡´æ€§ã€‚
3. **æµ‹è¯•APIç«¯ç‚¹**ï¼šä½¿ç”¨å·¥å…·ï¼ˆå¦‚curlæˆ–Postmanï¼‰ç›´æ¥è°ƒç”¨ç›¸å…³APIæ¥å£ï¼ŒéªŒè¯å…¶å“åº”æ˜¯å¦æ­£å¸¸ã€‚
4. **åˆ†æå‰ç«¯è¡Œä¸º**ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨JavaScripté”™è¯¯æˆ–ç½‘ç»œè¯·æ±‚å¤±è´¥ã€‚
5. **å¤ç°é—®é¢˜åœºæ™¯**ï¼šæ ¹æ®ç”¨æˆ·åé¦ˆæˆ–æ—¥å¿—æè¿°ï¼Œå°è¯•åœ¨æœ¬åœ°ç¯å¢ƒä¸­å¤ç°é—®é¢˜ã€‚

æ­¤æµç¨‹å¯ç¡®ä¿é—®é¢˜å¾—åˆ°å…¨é¢æ’æŸ¥ï¼Œé¿å…é—æ¼å…³é”®ç¯èŠ‚ã€‚

## å¸¸è§æ•…éšœä¸è§£å†³æ–¹æ¡ˆ

### Next.js 15 æ„å»ºé”™è¯¯
#### é—®é¢˜æè¿°
åœ¨æ‰§è¡Œ`npm run build`æ—¶ï¼Œ`/auth/signin`å’Œ`/upload`é¡µé¢å‡ºç°`useSearchParams()`æœªè¢«`Suspense`è¾¹ç•ŒåŒ…è£¹çš„é”™è¯¯ï¼ŒåŒæ—¶å­˜åœ¨å¤šä¸ªReact Hookä¾èµ–è­¦å‘Šã€‚

#### æ ¹æœ¬åŸå› 
Next.js 15è¦æ±‚åœ¨é¢„æ¸²æŸ“æ—¶ä½¿ç”¨`useSearchParams()`å¿…é¡»è¢«`Suspense`è¾¹ç•ŒåŒ…è£¹ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ„å»ºå¤±è´¥ã€‚

#### è§£å†³æ–¹æ¡ˆ
å°†ä½¿ç”¨`useSearchParams()`çš„é€»è¾‘æå–åˆ°ç‹¬ç«‹å­ç»„ä»¶ä¸­ï¼Œå¹¶ç”¨`Suspense`åŒ…è£¹è¯¥å­ç»„ä»¶ã€‚

```tsx
// ç¤ºä¾‹ï¼šsigniné¡µé¢ä¿®å¤
function SignInForm() {
  const searchParams = useSearchParams();
  const callbackUrl = searchParams.get('callbackUrl');
  // ... å…¶ä»–é€»è¾‘
}

export default function SignInPage() {
  return (
    <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
      <SignInForm />
    </Suspense>
  );
}
```

#### å®é™…åº”ç”¨
- `src/app/auth/signin/page.tsx`å·²æŒ‰æ­¤æ–¹æ¡ˆä¿®å¤ï¼ˆè§[SPEC SYMBOL](file://src/app/auth/signin/page.tsx#L1-L153)ï¼‰
- `src/app/upload/page.tsx`åŒæ ·é‡‡ç”¨è¯¥æ¨¡å¼ï¼ˆè§[SPEC SYMBOL](file://src/app/upload/page.tsx#L1-L644)ï¼‰

**Section sources**
- [nextjs15-build-error.md](file://log/nextjs15-build-error.md#L1-L57)
- [signin/page.tsx](file://src/app/auth/signin/page.tsx#L1-L153)
- [upload/page.tsx](file://src/app/upload/page.tsx#L1-L644)

### åœ¨çº¿äººæ•°ç»Ÿè®¡ç»„ä»¶é—®é¢˜
#### é—®é¢˜æè¿°
ç”¨æˆ·è¦æ±‚åœ¨ä¸»é¡µæ·»åŠ ä¸€ä¸ªæ¨¡æ‹Ÿåœ¨çº¿äººæ•°è®¡æ•°å™¨ç»„ä»¶ï¼Œæ˜¾ç¤º"xxxäººæ­£åœ¨äº‘æ –å¤§ä¼šåˆ›ä½œ"ï¼Œå¹¶ä½œä¸ºå¤§æ¨ªå¹…æ˜¾ç¤ºåœ¨é¡¶æ ä½ç½®ã€‚

#### æŠ€æœ¯å®ç°
- ç»„ä»¶ä½ç½®ï¼š`src/components/OnlineCounter.tsx`
- æ ¸å¿ƒé€»è¾‘ï¼šä»åŸºæ•°1075å¼€å§‹ï¼Œæ¯10ç§’é€šè¿‡APIè·å–æœ€æ–°æ•°æ®å¹¶éšæœºå¢é•¿
- æ ·å¼è®¾è®¡ï¼šæ©™çº¢è‰²æ¸å˜èƒŒæ™¯ï¼ŒåŒ…å«ç«ç®­emojiå’ŒåŠ¨ç”»æ•ˆæœ

#### é›†æˆæ–¹æ¡ˆ
1. åˆ›å»º`OnlineCounter`ç»„ä»¶ï¼ˆè§[SPEC SYMBOL](file://src/components/OnlineCounter.tsx#L15-L157)ï¼‰
2. åœ¨`Header.tsx`ä¸­é›†æˆï¼Œä½œä¸ºé¡¶æ ä¸‹æ–¹çš„å¤§æ¨ªå¹…ï¼ˆè§[SPEC SYMBOL](file://src/components/Header.tsx#L1-L118)ï¼‰
3. ç§»é™¤`page.tsx`ä¸­çš„é‡å¤å¼•ç”¨ï¼Œè§£å†³åŒæ¨ªå¹…é—®é¢˜

#### APIæ”¯æŒ
- `GET /api/online-counter`ï¼šè·å–å½“å‰åœ¨çº¿äººæ•°ï¼ˆè§[SPEC SYMBOL](file://src/app/api/online-counter/route.ts#L1-L189)ï¼‰
- æ”¯æŒæ‰‹åŠ¨å¢åŠ äººæ•°çš„POSTæ¥å£ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰

#### æ½œåœ¨é—®é¢˜ä¸ä¼˜åŒ–
- **ç¼“å­˜å¤±æ•ˆé£é™©**ï¼šå½“å‰å®ç°ä¾èµ–æ•°æ®åº“å­˜å‚¨é…ç½®ï¼Œè‹¥æ•°æ®åº“è¿æ¥ä¸­æ–­å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±
- **å¹¶å‘æ›´æ–°é—®é¢˜**ï¼šå¤šä¸ªå®ä¾‹åŒæ—¶æ›´æ–°æ—¶å¯èƒ½å‡ºç°ç«æ€æ¡ä»¶
- **ä¼˜åŒ–å»ºè®®**ï¼š
  - å¼•å…¥Redisç¼“å­˜å±‚ï¼Œæé«˜è¯»å–æ€§èƒ½
  - ä½¿ç”¨åˆ†å¸ƒå¼é”æœºåˆ¶é˜²æ­¢å¹¶å‘æ›´æ–°å†²çª
  - å¢åŠ æœ¬åœ°ç¼“å­˜é™çº§ç­–ç•¥ï¼Œä¿è¯æ•°æ®åº“ä¸å¯ç”¨æ—¶ä»èƒ½æä¾›åŸºæœ¬æœåŠ¡

**Section sources**
- [online-counter-issue.md](file://log/online-counter-issue.md#L1-L32)
- [OnlineCounter.tsx](file://src/components/OnlineCounter.tsx#L15-L157)
- [route.ts](file://src/app/api/online-counter/route.ts#L1-L189)
- [Header.tsx](file://src/components/Header.tsx#L1-L118)

### éšæœºç‚¹èµåŠŸèƒ½å¼‚å¸¸
#### é—®é¢˜æè¿°
ç‚¹èµåŠŸèƒ½å¯èƒ½å‡ºç°é‡å¤è®¡æ•°æˆ–å¼‚å¸¸è¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ã€‚

#### åŠŸèƒ½éœ€æ±‚
åœ¨ä½œå“å®¡æ ¸é€šè¿‡æ—¶ï¼Œä¸ºæ–°ä½œå“è‡ªåŠ¨èµ‹äºˆ10-50ä¹‹é—´çš„éšæœºåˆå§‹ç‚¹èµæ•°ã€‚

#### å®ç°æ–¹æ¡ˆ
ä¿®æ”¹`src/app/api/admin/works/[id]/route.ts`ä¸­çš„å®¡æ ¸é€»è¾‘ï¼š

```typescript
if (status === 'APPROVED' && existingWork.status !== 'APPROVED') {
  const randomLikes = Math.floor(Math.random() * 41) + 10;
  updateData.likeCount = randomLikes;
}
```

#### è°ƒè¯•æ–¹æ³•
1. **æ£€æŸ¥çŠ¶æ€å˜æ›´é€»è¾‘**ï¼šç¡®ä¿åªåœ¨ä½œå“é¦–æ¬¡è¢«æ‰¹å‡†æ—¶æ·»åŠ éšæœºç‚¹èµæ•°
2. **éªŒè¯éšæœºæ•°èŒƒå›´**ï¼šç¡®è®¤ç”Ÿæˆçš„éšæœºæ•°åœ¨10-50ä¹‹é—´
3. **æµ‹è¯•å¹¶å‘åœºæ™¯**ï¼šæ¨¡æ‹Ÿå¤šä¸ªç®¡ç†å‘˜åŒæ—¶å®¡æ ¸ä½œå“ï¼Œè§‚å¯Ÿç‚¹èµæ•°æ˜¯å¦æ­£ç¡®
4. **æŸ¥çœ‹æ•°æ®åº“è®°å½•**ï¼šé€šè¿‡`verify-database.ts`è„šæœ¬æ£€æŸ¥ä½œå“çš„`likeCount`å­—æ®µ

#### å¸¸è§é—®é¢˜
- **é‡å¤å®¡æ ¸é‡ç½®ç‚¹èµæ•°**ï¼šå½“å‰é€»è¾‘å·²é¿å…æ­¤é—®é¢˜ï¼Œä»…åœ¨çŠ¶æ€ä»éAPPROVEDå˜ä¸ºAPPROVEDæ—¶æ·»åŠ 
- **éšæœºæ•°åˆ†å¸ƒä¸å‡**ï¼šä½¿ç”¨`Math.random()`å¯èƒ½å¯¼è‡´åˆ†å¸ƒä¸å¤Ÿå‡åŒ€ï¼Œå¯è€ƒè™‘ä½¿ç”¨æ›´é«˜è´¨é‡çš„éšæœºæ•°ç”Ÿæˆå™¨

**Section sources**
- [random-likes-feature.md](file://log/random-likes-feature.md#L1-L37)
- [route.ts](file://src/app/api/admin/works/[id]/route.ts#L1-L252)

## æ•°æ®åº“éªŒè¯è„šæœ¬ä½¿ç”¨è¯´æ˜
`verify-database.ts`è„šæœ¬ç”¨äºæ£€æŸ¥æ•°æ®åº“è¿æ¥å’Œæ•°æ®ä¸€è‡´æ€§ï¼Œæ˜¯æ•…éšœæ’æŸ¥çš„é‡è¦å·¥å…·ã€‚

### ä½¿ç”¨æ–¹æ³•
```bash
# éªŒè¯æ•°æ®åº“çŠ¶æ€
npx ts-node verify-database.ts

# åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
npx ts-node verify-database.ts --create-admin
```

### åŠŸèƒ½ç‰¹æ€§
- æµ‹è¯•æ•°æ®åº“è¿æ¥
- ç»Ÿè®¡ç”¨æˆ·æ€»æ•°å’Œç®¡ç†å‘˜ç”¨æˆ·
- æ˜¾ç¤ºä½œå“çŠ¶æ€åˆ†å¸ƒ
- æ£€æŸ¥æœ€æ–°5ä¸ªä½œå“
- éªŒè¯ä¸Šä¼ å’Œå¹³å°é…ç½®

### é”™è¯¯å¤„ç†
è„šæœ¬åŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š
- `P1001`é”™è¯¯ï¼šæ£€æŸ¥æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²å’Œç½‘ç»œè¿æ¥
- `P2021`é”™è¯¯ï¼šæ•°æ®åº“è¡¨ä¸å­˜åœ¨ï¼Œéœ€è¦è¿è¡Œè¿ç§»
- å…¶ä»–é”™è¯¯ï¼šè¾“å‡ºè¯¦ç»†é”™è¯¯ä¿¡æ¯ä¾›æ’æŸ¥

### è¾“å‡ºç¤ºä¾‹
```
ğŸ” å¼€å§‹éªŒè¯æ•°æ®åº“è¿æ¥å’Œæ•°æ®...
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
ğŸ‘¥ ç”¨æˆ·æ€»æ•°: 15
ğŸ‘‘ ç®¡ç†å‘˜ç”¨æˆ·: [ { id: '1', email: 'admin@yunqi.com', name: 'ç®¡ç†å‘˜', role: 'ADMIN' } ]
ğŸ¨ ä½œå“ç»Ÿè®¡:
  APPROVED: 12 ä¸ª
  PENDING: 3 ä¸ª
âš™ï¸ ä¸Šä¼ é…ç½®: å·²é…ç½®
ğŸ  å¹³å°é…ç½®: Qcoderå’Œé€šä¹‰çµç  AI Coding ä½œå“ç§€
âœ… æ•°æ®åº“éªŒè¯å®Œæˆ
```

**Section sources**
- [verify-database.ts](file://verify-database.ts#L1-L126)

## é™„å½•
### ç›¸å…³æ–‡ä»¶è·¯å¾„
- æ—¥å¿—æ–‡ä»¶ï¼š`log/`ç›®å½•ä¸‹
- æ ¸å¿ƒç»„ä»¶ï¼š`src/components/`ç›®å½•ä¸‹
- APIè·¯ç”±ï¼š`src/app/api/`ç›®å½•ä¸‹
- æ•°æ®åº“è„šæœ¬ï¼šé¡¹ç›®æ ¹ç›®å½•

### æ¨èæ’æŸ¥å·¥å…·
- `npx ts-node verify-database.ts`ï¼šæ•°æ®åº“çŠ¶æ€æ£€æŸ¥
- æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼šå‰ç«¯é”™è¯¯æ’æŸ¥
- Postman/curlï¼šAPIæ¥å£æµ‹è¯•
- Prisma Studioï¼šæ•°æ®åº“å¯è§†åŒ–æŸ¥çœ‹