# æ„å»ºé—®é¢˜

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**  
- [nextjs15-build-error.md](file://log/nextjs15-build-error.md)
- [nextjs15-type-fixes-report.md](file://src/nextjs15-type-fixes-report.md)
- [tsconfig.json](file://tsconfig.json)
- [auth.ts](file://src/lib/auth.ts)
- [signin/page.tsx](file://src/app/auth/signin/page.tsx)
- [upload/page.tsx](file://src/app/upload/page.tsx)
</cite>

## ç›®å½•
1. [é—®é¢˜æ¦‚è¿°](#é—®é¢˜æ¦‚è¿°)
2. [ç±»å‹æ£€æŸ¥å¤±è´¥](#ç±»å‹æ£€æŸ¥å¤±è´¥)
3. [æ¨¡å—è§£æå¼‚å¸¸](#æ¨¡å—è§£æå¼‚å¸¸)
4. [æ„å»ºä¼˜åŒ–æŠ¥é”™](#æ„å»ºä¼˜åŒ–æŠ¥é”™)
5. [TypeScripté…ç½®å…¼å®¹æ€§](#typescripté…ç½®å…¼å®¹æ€§)
6. [è°ƒè¯•æ„å»ºæµç¨‹æŠ€å·§](#è°ƒè¯•æ„å»ºæµç¨‹æŠ€å·§)
7. [è§£å†³æ–¹æ¡ˆæ€»ç»“](#è§£å†³æ–¹æ¡ˆæ€»ç»“)
8. [åç»­å»ºè®®](#åç»­å»ºè®®)

## é—®é¢˜æ¦‚è¿°

åœ¨å‡çº§è‡³Next.js 15åï¼Œé¡¹ç›®æ„å»ºè¿‡ç¨‹ä¸­å‡ºç°å¤šç§é”™è¯¯ï¼Œä¸»è¦åŒ…æ‹¬ç±»å‹æ£€æŸ¥å¤±è´¥ã€æ¨¡å—è§£æå¼‚å¸¸å’Œæ„å»ºä¼˜åŒ–é˜¶æ®µçš„æŠ¥é”™ã€‚è¿™äº›é—®é¢˜å½±å“äº†`npm run build`çš„æ­£å¸¸æ‰§è¡Œï¼Œå¯¼è‡´éƒ¨åˆ†é¡µé¢æ— æ³•æˆåŠŸé¢„æ¸²æŸ“ã€‚

**æ ¸å¿ƒé—®é¢˜åˆ†ç±»**ï¼š
- **ç±»å‹æ£€æŸ¥å¤±è´¥**ï¼šNext.js 15å¯¹APIè·¯ç”±çš„å‡½æ•°ç­¾åå’ŒåŠ¨æ€è·¯ç”±å‚æ•°ç±»å‹æå‡ºäº†æ›´ä¸¥æ ¼çš„è¦æ±‚
- **æ¨¡å—è§£æå¼‚å¸¸**ï¼š`useSearchParams()`ç­‰å®¢æˆ·ç«¯Hookåœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶éœ€è¢«`Suspense`è¾¹ç•ŒåŒ…è£¹
- **æ„å»ºä¼˜åŒ–æŠ¥é”™**ï¼šä¸TypeScripté…ç½®å’Œä¾èµ–ç‰ˆæœ¬å…¼å®¹æ€§ç›¸å…³çš„é—®é¢˜

**å½±å“èŒƒå›´**ï¼š
- `/auth/signin` é¡µé¢ï¼š`useSearchParams()` æœªè¢« `Suspense` åŒ…è£¹
- `/upload` é¡µé¢ï¼šåŒæ ·å­˜åœ¨ `useSearchParams()` é—®é¢˜
- å¤šä¸ªAPIè·¯ç”±ï¼š`withAuth` å‡½æ•°ç­¾åä¸å…¼å®¹ã€åŠ¨æ€è·¯ç”±å‚æ•°ç±»å‹é”™è¯¯

**çŠ¶æ€**ï¼šğŸ”„ è¿›è¡Œä¸­ï¼ˆupload é¡µé¢å¾…ä¿®å¤ï¼‰

**Section sources**
- [nextjs15-build-error.md](file://log/nextjs15-build-error.md#L1-L56)
- [nextjs15-type-fixes-report.md](file://src/nextjs15-type-fixes-report.md#L1-L256)

## ç±»å‹æ£€æŸ¥å¤±è´¥

### é—®é¢˜ç—‡çŠ¶
åœ¨æ‰§è¡Œæ„å»ºæ—¶ï¼ŒTypeScriptç¼–è¯‘å™¨æŠ¥å‡ºä»¥ä¸‹ç±»å‹é”™è¯¯ï¼š
1. `withAuth` å‡½æ•°å‚æ•°ç±»å‹ä¸åŒ¹é…
2. åŠ¨æ€è·¯ç”±çš„ `params` å‚æ•°ç±»å‹é”™è¯¯
3. ç”¨æˆ·æ³¨å†Œæ¥å£ç¼ºå°‘å¿…éœ€å­—æ®µ

### æ ¹æœ¬åŸå› 
Next.js 15å¼•å…¥äº†æ›´ä¸¥æ ¼çš„ç±»å‹å®‰å…¨æœºåˆ¶ï¼š
- **APIè·¯ç”±ç­¾å**ï¼šè¦æ±‚é™æ€è·¯ç”±å’ŒåŠ¨æ€è·¯ç”±çš„å‡½æ•°ç­¾åä¿æŒä¸€è‡´
- **åŠ¨æ€è·¯ç”±å‚æ•°**ï¼š`params` ç°åœ¨å¿…é¡»æ˜¯ `Promise` ç±»å‹ï¼Œéœ€è¦ä½¿ç”¨ `await` è®¿é—®
- **æ•°æ®æ¨¡å‹å˜æ›´**ï¼šPrisma Useræ¨¡å‹æ›´æ–°åï¼Œ`name` å’Œ `phone` å­—æ®µå˜ä¸ºå¿…éœ€

### å¤ç°æ­¥éª¤
1. å‡çº§Next.jsè‡³15ç‰ˆæœ¬
2. è¿è¡Œ `npm run build`
3. è§‚å¯ŸTypeScriptç¼–è¯‘é”™è¯¯

### è§£å†³æ–¹æ¡ˆ

#### ä¿®å¤withAuthå‡½æ•°ç±»å‹å®šä¹‰
é€šè¿‡å°†`context`å‚æ•°è®¾ä¸ºå¯é€‰ï¼Œå…¼å®¹é™æ€å’ŒåŠ¨æ€è·¯ç”±ï¼š

[SPEC SYMBOL](file://src/lib/auth.ts#L1-L72)

#### ä¿®å¤åŠ¨æ€è·¯ç”±paramsç±»å‹
å°†`params`ç±»å‹æ”¹ä¸º`Promise`ï¼Œå¹¶ä½¿ç”¨`await`è®¿é—®ï¼š

[SPEC SYMBOL](file://src/app/api/admin/users/[id]/route.ts#L1-L20)

#### ä¿®å¤ç”¨æˆ·æ³¨å†Œæ•°æ®æ¨¡å‹
æ·»åŠ `name`å’Œ`phone`å­—æ®µçš„å¤„ç†é€»è¾‘åŠéªŒè¯ï¼š

[SPEC SYMBOL](file://src/app/api/register/route.ts#L1-L50)

**Section sources**
- [nextjs15-type-fixes-report.md](file://src/nextjs15-type-fixes-report.md#L19-L81)
- [auth.ts](file://src/lib/auth.ts#L1-L72)

## æ¨¡å—è§£æå¼‚å¸¸

### é—®é¢˜ç—‡çŠ¶
æ„å»ºæ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š
- `/auth/signin` é¡µé¢ï¼š`useSearchParams()` æœªè¢« `Suspense` è¾¹ç•ŒåŒ…è£¹
- `/upload` é¡µé¢ï¼šåŒæ ·çš„ `useSearchParams()` é—®é¢˜

### æ ¹æœ¬åŸå› 
Next.js 15è¦æ±‚åœ¨é¢„æ¸²æŸ“æ—¶ä½¿ç”¨ `useSearchParams()` å¿…é¡»è¢« `Suspense` è¾¹ç•ŒåŒ…è£¹ï¼Œä»¥å¤„ç†æœåŠ¡ç«¯æ¸²æŸ“æ—¶çš„å¼‚æ­¥çŠ¶æ€ã€‚

### å¤ç°æ­¥éª¤
1. åœ¨é¡µé¢ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨ `useSearchParams()`
2. è¿è¡Œ `npm run build`
3. æ„å»ºå¤±è´¥ï¼Œæç¤ºéœ€è¦ `Suspense` è¾¹ç•Œ

### è§£å†³æ–¹æ¡ˆ

#### ä¿®å¤signiné¡µé¢
å°†ä½¿ç”¨ `useSearchParams` çš„é€»è¾‘æå–åˆ°å­ç»„ä»¶ï¼Œå¹¶ç”¨ `Suspense` åŒ…è£¹ï¼š

[SPEC SYMBOL](file://src/app/auth/signin/page.tsx#L1-L153)

#### ä¿®å¤uploadé¡µé¢
é‡‡ç”¨ç›¸åŒçš„æ¨¡å¼å¤„ç†ä¸Šä¼ é¡µé¢ï¼š

[SPEC SYMBOL](file://src/app/upload/page.tsx#L1-L645)

```mermaid
flowchart TD
A[é¡µé¢å…¥å£] --> B{æ˜¯å¦ä½¿ç”¨<br/>useSearchParams?}
B --> |æ˜¯| C[æå–åˆ°å­ç»„ä»¶]
B --> |å¦| D[ç›´æ¥æ¸²æŸ“]
C --> E[ç”¨SuspenseåŒ…è£¹]
E --> F[æä¾›fallback]
F --> G[æ¸²æŸ“å­ç»„ä»¶]
G --> H[è·å–searchParams]
H --> I[æ­£å¸¸ä¸šåŠ¡é€»è¾‘]
```

**Diagram sources**
- [signin/page.tsx](file://src/app/auth/signin/page.tsx#L1-L153)
- [upload/page.tsx](file://src/app/upload/page.tsx#L1-L645)

**Section sources**
- [nextjs15-build-error.md](file://log/nextjs15-build-error.md#L1-L56)
- [signin/page.tsx](file://src/app/auth/signin/page.tsx#L1-L153)
- [upload/page.tsx](file://src/app/upload/page.tsx#L1-L645)

## æ„å»ºä¼˜åŒ–æŠ¥é”™

### é—®é¢˜ç—‡çŠ¶
æ„å»ºä¼˜åŒ–é˜¶æ®µå¯èƒ½å‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š
- æ‰“åŒ…ä½“ç§¯è¿‡å¤§
- é™æ€èµ„æºåŠ è½½ç¼“æ…¢
- Tree-shakingä¸å½»åº•

### æ ¹æœ¬åŸå› 
- TypeScripté…ç½®æœªé’ˆå¯¹æ„å»ºä¼˜åŒ–
- ä¾èµ–ç‰ˆæœ¬ä¸å…¼å®¹
- æœªå¯ç”¨é€‚å½“çš„æ„å»ºåˆ†æå·¥å…·

### è§£å†³æ–¹æ¡ˆ
1. å¯ç”¨ `source-map-explorer` åˆ†æåŒ…ä½“ç§¯
2. ä¼˜åŒ– `tsconfig.json` é…ç½®
3. å‡çº§ç›¸å…³ä¾èµ–ç‰ˆæœ¬

**Section sources**
- [tsconfig.json](file://tsconfig.json#L1-L42)

## TypeScripté…ç½®å…¼å®¹æ€§

### é—®é¢˜åˆ†æ
å½“å‰ `tsconfig.json` é…ç½®ä¸Next.js 15çš„å…¼å®¹æ€§æƒ…å†µï¼š

```json
{
  "compilerOptions": {
    "lib": ["dom", "dom.iterable", "es6"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [{ "name": "next" }],
    "baseUrl": ".",
    "paths": { "@/*": ["./src/*"] },
    "target": "ES2017"
  }
}
```

### å…¼å®¹æ€§å»ºè®®
1. **ä¿æŒç°æœ‰é…ç½®**ï¼šå½“å‰é…ç½®åŸºæœ¬å…¼å®¹Next.js 15
2. **å‡çº§TypeScript**ï¼šç¡®ä¿ä½¿ç”¨ `^5.7.2` æˆ–æ›´é«˜ç‰ˆæœ¬
3. **å¯ç”¨ä¸¥æ ¼æ¨¡å¼**ï¼š`"strict": true` å·²å¯ç”¨ï¼Œæœ‰åŠ©äºå‘ç°ç±»å‹é—®é¢˜

### ä¾èµ–ç‰ˆæœ¬è¦æ±‚
- **Next.js**: 15.1.0
- **TypeScript**: >=4.8.4
- **eslint-config-next**: 15.1.0

**Section sources**
- [tsconfig.json](file://tsconfig.json#L1-L42)
- [package-lock.json](file://package-lock.json#L41-L76)

## è°ƒè¯•æ„å»ºæµç¨‹æŠ€å·§

### å¯ç”¨verboseæ—¥å¿—
åœ¨ `next.config.ts` ä¸­å¯ç”¨è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼š

```typescript
module.exports = {
  logging: {
    level: 'verbose'
  }
}
```

### ä½¿ç”¨source-map-exploreråˆ†æåŒ…ä½“ç§¯
1. å®‰è£…å·¥å…·ï¼š`npm install --save-dev source-map-explorer`
2. æ„å»ºé¡¹ç›®ï¼š`npm run build`
3. åˆ†æç»“æœï¼š`npx source-map-explorer .next/static/**/*.js`

### å…¶ä»–è°ƒè¯•æŠ€å·§
1. **å¢é‡ç¼–è¯‘**ï¼šåˆ©ç”¨ `incremental: true` æé«˜æ„å»ºé€Ÿåº¦
2. **ç±»å‹æ£€æŸ¥åˆ†ç¦»**ï¼šåœ¨CI/CDä¸­å•ç‹¬è¿è¡Œ `tsc --noEmit` è¿›è¡Œç±»å‹æ£€æŸ¥
3. **ç¼“å­˜åˆ©ç”¨**ï¼šç¡®ä¿ `.next` ç›®å½•æ­£ç¡®ç¼“å­˜æ„å»ºç»“æœ

**Section sources**
- [tsconfig.json](file://tsconfig.json#L1-L42)
- [next.config.ts](file://next.config.ts#L1-L20)

## è§£å†³æ–¹æ¡ˆæ€»ç»“

### å·²è§£å†³é—®é¢˜
- âœ… `withAuth` å‡½æ•°ç±»å‹é”™è¯¯å·²ä¿®å¤
- âœ… åŠ¨æ€è·¯ç”±paramsç±»å‹é”™è¯¯å·²ä¿®å¤
- âœ… ç”¨æˆ·æ³¨å†Œæ•°æ®æ¨¡å‹é”™è¯¯å·²ä¿®å¤
- âœ… signiné¡µé¢`useSearchParams`é—®é¢˜å·²è§£å†³

### å¾…è§£å†³é—®é¢˜
- ğŸ”„ uploadé¡µé¢`useSearchParams`é—®é¢˜å¾…ä¿®å¤

### ä¿®å¤ç­–ç•¥
1. **ç»Ÿä¸€å‡½æ•°ç­¾å**ï¼šä¿®æ”¹`withAuth`å‡½æ•°ä½¿å…¶å…¼å®¹é™æ€å’ŒåŠ¨æ€è·¯ç”±
2. **é€‚é…æ–°API**ï¼šå°†åŠ¨æ€è·¯ç”±çš„`params`å‚æ•°æ”¹ä¸º`Promise`ç±»å‹
3. **å®Œå–„æ•°æ®æ¨¡å‹**ï¼šæ·»åŠ Prismaæ¨¡å‹è¦æ±‚çš„å¿…éœ€å­—æ®µ
4. **ç»„ä»¶é‡æ„**ï¼šå°†ä½¿ç”¨å®¢æˆ·ç«¯Hookçš„é€»è¾‘æå–åˆ°å­ç»„ä»¶

**Section sources**
- [nextjs15-type-fixes-report.md](file://src/nextjs15-type-fixes-report.md#L1-L256)
- [nextjs15-build-error.md](file://log/nextjs15-build-error.md#L1-L56)

## åç»­å»ºè®®

1. **å®šæœŸæ›´æ–°**ï¼šå…³æ³¨Next.jsç‰ˆæœ¬æ›´æ–°ï¼ŒåŠæ—¶é€‚é…æ–°çš„APIå˜æ›´
2. **ç±»å‹æ£€æŸ¥**ï¼šåœ¨CI/CDæµç¨‹ä¸­åŠ å…¥ä¸¥æ ¼çš„TypeScriptç±»å‹æ£€æŸ¥
3. **æµ‹è¯•è¦†ç›–**ï¼šä¸ºAPIè·¯ç”±æ·»åŠ å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
4. **æ–‡æ¡£ç»´æŠ¤**ï¼šåŠæ—¶æ›´æ–°APIæ–‡æ¡£ï¼Œåæ˜ æœ€æ–°çš„æ¥å£å˜æ›´
5. **æ„å»ºç›‘æ§**ï¼šå®šæœŸä½¿ç”¨`source-map-explorer`åˆ†æåŒ…ä½“ç§¯å˜åŒ–
6. **ä¾èµ–ç®¡ç†**ï¼šä¿æŒä¾èµ–ç‰ˆæœ¬çš„åŠæ—¶æ›´æ–°ï¼Œé¿å…å…¼å®¹æ€§é—®é¢˜

**Section sources**
- [nextjs15-type-fixes-report.md](file://src/nextjs15-type-fixes-report.md#L251-L256)