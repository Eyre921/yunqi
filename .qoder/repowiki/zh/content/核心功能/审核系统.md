
# 审核系统

<cite>
**本文档引用的文件**   
- [WorksManagement.tsx](file://src/components/admin/WorksManagement.tsx)
- [AdminDashboard.tsx](file://src/components/admin/AdminDashboard.tsx)
- [prisma/migrations/20250831084947_add_featured_field/migration.sql](file://prisma/migrations/20250831084947_add_featured_field/migration.sql)
- [route.ts](file://src/app/api/admin/works/[id]/route.ts)
- [route.ts](file://src/app/api/admin/works/[id]/featured/route.ts)
- [work.d.ts](file://src/types/work.d.ts)
</cite>

## 目录
1. [简介](#简介)
2. [管理员界面操作](#管理员界面操作)
3. [审核API调用流程](#审核api调用流程)
4. [状态变更逻辑与数据库更新](#状态变更逻辑与数据库更新)
5. [精选作品标记机制](#精选作品标记机制)
6. [权限控制逻辑](#权限控制逻辑)
7. [审核状态字段演进](#审核状态字段演进)
8. [常见问题与调试方法](#常见问题与调试方法)
9. [扩展建议：审核日志审计](#扩展建议审核日志审计)

## 简介
本系统为数字化作品互动展示平台的核心审核模块，支持管理员对用户提交的作品进行审核、状态管理及精选操作。系统通过前后端协同实现完整的审核流程，包含待审核、已通过、已拒绝三种状态，并支持将通过审核的作品设为“精选”。前端管理员界面提供筛选、搜索、排序功能，后端通过API处理状态变更并更新数据库。系统具备良好的可扩展性，可通过引入审核日志机制进一步增强审计能力。

## 管理员界面操作

管理员通过`/admin`页面访问后台管理系统，界面由`AdminDashboard`组件构建，包含“作品管理”、“上传配置”、“在线人数”、“平台配置”四个标签页。在“作品管理”标签页中，`WorksManagement`组件展示所有待审核及已审核作品列表。

界面支持以下操作：
- **状态筛选**：按“待审核”、“已通过”、“已拒绝”筛选作品
- **关键词搜索**：根据作品名称或作者进行模糊搜索
- **排序功能**：对已通过作品按提交时间、审批时间、点赞量、浏览量进行升序或降序排列
- **分页浏览**：每页显示10条记录，支持上下页切换

作品列表以表格形式展示，包含作品缩略图、作者信息、当前状态、数据统计（浏览量、点赞数）、提交时间等字段。操作列提供“通过”、“拒绝”、“重新审核”、“设为精选/取消精选”等按钮，支持在列表页或弹出的详情模态框中进行操作。

**Section sources**
- [AdminDashboard.tsx](file://src/components/admin/AdminDashboard.tsx#L12-L89)
- [WorksManagement.tsx](file://src/components/admin/WorksManagement.tsx#L12-L570)

## 审核API调用流程

审核操作通过前端调用后端API完成，主要涉及两个API端点：

1. **状态变更API**：`PATCH /api/admin/works/[id]`
   - 用于处理作品的审核通过或拒绝操作
   - 请求体包含`status`字段（`APPROVED`或`REJECTED`）和可选的`rejectReason`
   - 前端通过`handleStatusChange`函数发起请求

2. **精选状态变更API**：`PATCH /api/admin/works/[id]/featured`
   - 用于设置或取消作品的精选状态
   - 请求体包含`featured`布尔值
   - 前端通过`handleFeaturedChange`函数发起请求

```mermaid
sequenceDiagram
    participant 前端 as 前端界面
    participant API as 审核API
    participant 数据库 as 数据库
    
    前端->>API: PATCH /api/admin/works/{id}
    API->>数据库: 更新作品状态
    数据库-->>API: 返回更新结果
    API-->>前端: 返回